<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Reputation Scheme (SC+FP)</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="about.html">About</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="1-impacts.html"><strong aria-hidden="true">1.</strong> The impacts of channel jamming</a></li><li class="chapter-item expanded "><a href="2-costs.html"><strong aria-hidden="true">2.</strong> Channel jamming costs</a></li><li class="chapter-item expanded "><a href="3-incremental_solutions.html"><strong aria-hidden="true">3.</strong> Incremental solutions to jamming</a></li><li class="chapter-item expanded "><a href="4-design_space.html"><strong aria-hidden="true">4.</strong> Solution Design space</a></li><li class="chapter-item expanded "><a href="5-advanced_upfront.html"><strong aria-hidden="true">5.</strong> Advanced Upfront Fee (hold-time)</a></li><li class="chapter-item expanded "><a href="6-reputation.html" class="active"><strong aria-hidden="true">6.</strong> Reputation Scheme (SC+FP)</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="grand-conclusion.html">Subjective Grand Conclusion</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="chapter-6-the-reputation-scheme-stake-certificates--forwarding-pass"><a class="header" href="#chapter-6-the-reputation-scheme-stake-certificates--forwarding-pass"><strong>Chapter 6: The Reputation Scheme: Stake Certificates + Forwarding Pass</strong></a></h1>
<h1 id="intro"><a class="header" href="#intro"><strong>Intro</strong></a></h1>
<p>In this chapter, we discuss how a concrete reputation-based scheme could solve channel jamming. We propose a system based on Stake Certificates (an ID based on the zero-knowledge proof of UTXO ownership initially proposed on the <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-November/002884.html">mailing list</a>) and Forwarding Pass (a reputation issuance protocol initially authored by @Roasbeef to the best of our knowledge).</p>
<p>Historically, these two protocols were proposed separately. Each focused on only one aspect, leaving another one ambiguous. We argue that they would strongly benefit from each other. After describing both, we will discuss the efficiency of the combined solution and put it in the broader context.</p>
<h2 id="stakes-certificates-an-id-based-on-the-zero-knowledge-proof-of-utxo"><a class="header" href="#stakes-certificates-an-id-based-on-the-zero-knowledge-proof-of-utxo"><strong>Stakes Certificates: an ID based on the Zero-Knowledge proof of UTXO</strong></a></h2>
<p>As we discussed in Chapter 4, the first component of a reputation system is an ID. Stake Certificates protocol suggests proving UTXO ownership in zero-knowledge for an ID in the following way:</p>
<ol>
<li>The UTXO is part of the UTXO set at a defined time and restricted by the filter provided by the verifier (e.g., UTXO amount, freshness, Script content, etc.);</li>
<li>Prover knows the witness script of the UTXO;</li>
<li>Prover can construct a valid witness for the witness script;</li>
<li>A valid proof-of-UTXO ownership cannot be duplicated against the same prover.</li>
</ol>
<p>Once a payer constructed a payment path, proofs for each routing hop may be constructed. The proof is linked to the routing node’s public key, to prevent proof reuse by thisrouting node.</p>
<p align="center" width="100%">
    <img width="75%" src="pics/identity.png">
    <br />
    <i>Alice initiates the identity challenge request to Bob, the routing hop. Bob replies with a unique challenge to link the proof to a routing node secret (e.g the routing node’s private key). Alice generates a UTXO proof and sends to Bob, who verifies the correctness. If the proof is valid, Bob replied with reputation tokens. Communications can happen over onion messages channels or via other means. The exact number of rounds trips is function of the cryptosystems selected.</i>
</p>
<p>Historically, the Stakes Certificate system was proposed as a standalone solution to jamming. However, the reputation tracking part was always ambiguous. The most straightforward way to implement it would be to track reputation solely based on a concrete UTXO. This would, unfortunately, allow a routing node to correlate payments from the same proof. To improve on this, we propose to combine Stake Certificates with Forwarding Pass, which we will now describe.</p>
<h2 id="forwarding-pass-reputation-tokens-as-routing-credit-units"><a class="header" href="#forwarding-pass-reputation-tokens-as-routing-credit-units"><strong>Forwarding Pass: Reputation Tokens as Routing Credit Units</strong></a></h2>
<p>The second component of a reputation system is reputation algorithm. We suggest exchanging a proof-of-ID for a set of blinded tokens (used as credits for routing access) to make payments more private.</p>
<p><em>Historically, Forwarding Pass protocol was oblivious of the type of ID. We believe that linking it to a scarce resource could give routing nodes a useful tool within a reputation function. In the simplest case, they could just require basic proof-of-any-UTXO, which any LN sender can meet since they own a payment channel. More advanced policies could lead to better results. In the efficiency section, we will discuss why this is useful in more detail.</em></p>
<p>Routing a payment through a given routing node would require including a token issued by that routing node in the payment onion. If a token is not included or is invalid, a routing node would reject forwarding the payment.</p>
<p>A payment sender has to receive a separate set of tokens from every routing node according to the routing node issuance policy. The policy is gossiped across the network within channel updates. The policy could take the following factors into account:</p>
<ul>
<li>a value of one token (how much capital one token allows to lock);</li>
<li>token expiration (either specified at issuance time for every token, or uniform);</li>
<li>ID evaluation function: how many tokens are issued given certain properties associated with the ID (e.g., the value and the freshness of the UTXO);</li>
</ul>
<p>Tokens should be initially exchanged between the HTLC senders and a routing hop on the payment path by leveraging onion communication channels. To preserve payment anonymity, the exchange should be achieved through the usage of <a href="https://en.wikipedia.org/wiki/Blind_signature">blind signatures</a>, where the token is blindly signed by the hop at the provision of a valid identity and unblinded by the HTLC sender. <br />
<br />
Afterwards, a set of blinded tokens is provided at HTLC forward and, in case of success only, signed by the hop and exchanged during the HTLC settlement phase, in replacement of the consumed ones.</p>
<p align="center" width="100%">
    <img width="66%" src="pics/tokens_success.png">
    <br />
    <i>Alice pays Carol through Bob. Token B.1 obtained by Alice from Bob previously is attached within the “Bob’s” layer of Alice’s HTLC onion. Since Carol is a recipient, no token is sent to her. Upon successful resolution, a finalization message is propagated backward. Bob signes B.2, a new token for Alice, replacing B.1.
</i>
</p>
<p align="center" width="100%">
    <img width="66%" src="pics/tokens_fail.png">
    <br />
    <i>Alice pays Carol through Bob. Token B.1 obtained by Alice from Bob previously is attached within the “Bob’s” layer of Alice’s HTLC onion. Since Carol is a recipient, no token is sent to her. Upon failed resolution, a finalization message is propagated backward, without a new token.</i>
</p>
<p>The quality of a token issuance policy has a significant impact on the efficiency of this method against jamming.</p>
<h2 id="stake-certificates--forwarding-pass"><a class="header" href="#stake-certificates--forwarding-pass"><strong>Stake Certificates + Forwarding Pass</strong></a></h2>
<p>The efficiency of a jamming solution is measured as the cost (e.g., reputation) of locking the capital of the routing nodes. In Chapter 4, we discussed how the cost of attack either should equal the opportunity cost and compensate the victims; or, alternatively, not compensate the victims but be substantially higher than the opportunity cost.</p>
<p>Reputation systems combine the two: they encourage the former by threatening with the latter. Thus, the attack cost should be as high as possible.</p>
<p>This cost, however, has another bound: since it might be difficult to distinguish a jamming attack from an honest case, this burden will end up on the honest users as well. This trade-off could supposedly be solved by good reputation policies.</p>
<p>Now, we will discuss three ways of obtaining reputation, and how routing nodes can balance them to make it suitable for honest users while preventing jamming.</p>
<h3 id="grindingbuying-a-new-identity-with-a-base-reputation"><a class="header" href="#grindingbuying-a-new-identity-with-a-base-reputation"><strong>Grinding/buying a new identity with a base reputation</strong></a></h3>
<p>With Stake Certificates, the cost of obtaining a new identity with a base reputation fully depends on the reputation policy of a routing node.</p>
<p>First of all, routing nodes may or may not allow using channel funding UTXO (which every participant has) as an identity. Apart from that, the most straightforward case is buying a UTXO on the blockchain (e.g., an exchange), holding it for a certain time (as required by the policy), and then sell it.</p>
<p>The cost thus equals two transaction fees (to buy and to sell), and a potential loss due to the price difference between buying and selling, an exchange fee, and the opportunity cost of keeping the funds untouched. Given that the price difference is expected to be ~0 on average, and the on-chain fees could be optimized by low time preference, the opportunity cost is the major cost aspect.</p>
<p>A good protection means an attacker has to bear a substantially higher opportunity cost than the victim. Since the cost is the attacker’s opportunity cost, jamming X BTC over time T should require an attacker to lock <code>X*A BTC</code> (where <code>A &gt;&gt; 1</code>) over time T (or an equivalent), where A corresponds to the defence efficiency.</p>
<p>While a routing node indeed could enforce such a policy, it’s likely to be very unattractive for honest users. For example, if A=10, an DLC user would have to lock 10 BTC over a week before routing nodes agree to forward a DLC of 1 BTC over 2 hops.</p>
<p><strong>Burden on honest users and asymmetry</strong></p>
<p>There are two asymmetries between honest users and an attacker:</p>
<ol>
<li>One attacker’s UTXO can generate tokens at N routing nodes (assuming they don’t communicate). An honest user could be interested in only <code>M &amp;lt &lt; N</code> routing nodes.</li>
<li>An attacker might use proofs/tokens secondary market, while we can’t assume honest users will.</li>
</ol>
<p>These asymmetries have an unfortunate effect on the Stake Certificate value equilibrium: either the attack is too expensive, or the participation of an honest new user is too hard.</p>
<p>The asymmetry (1) could be solved as follows:</p>
<ul>
<li>allow bootstrapping of new honest users via some other means;</li>
<li>pick a really efficient UTXO valuation policy to distinguish an attacker from honest users;</li>
<li>information exchange between the routing nodes.</li>
</ul>
<p>The asymmetry (2) could be, unfortunately, fundamental.</p>
<h3 id="grinding-the-actual-reputation-with-honest-activity"><a class="header" href="#grinding-the-actual-reputation-with-honest-activity"><strong>Grinding the actual reputation with honest activity</strong></a></h3>
<p>Let’s now assume an attacker wants to honestly grind reputation to attack the system later. This process is associated with paying routing fees towards the target routing node.</p>
<p>To be “fair”, the jamming based on this honestly earned reputation should get a routing node fully compensated for the attack in previously paid fees. It is acceptable if an attacker doesn’t compensate the victim, but bears a much higher attack cost instead.</p>
<p>In any case, here comes the asymmetry again: a reputation system should find a sweet spot between benefiting honest users while limiting the attacker. This sweet spot should allow routing nodes to get a realistic chance for full compensation for liquidity lockups overall via serving honest senders at a reasonable cost, and avoiding attackers.</p>
<p><em>We believe that in this case designing such reputation policy is possible.</em></p>
<h3 id="buying-the-actual-reputation-on-a-secondary-market"><a class="header" href="#buying-the-actual-reputation-on-a-secondary-market"><strong>Buying the actual reputation on a secondary market</strong></a></h3>
<p>Let’s now consider a secondary market for reputation, which is <strong>a matter of a good reputation policy</strong>: it should provide honest senders with <em>just enough</em> reputation for them, discouraging them from selling it on a secondary market.</p>
<p>However, some senders indeed would have more reputation than they need, and the secondary market could emerge. Similarly to buying a fresh reputation, we assume that an attacker might use this secondary market while honest users won’t.</p>
<p>Ultimately, the feasibility of this threat then depends on whether:</p>
<ul>
<li>a slack in reputation policy would be sufficient for a secondary market to develop;</li>
<li>honest senders would refuse to sell on this secondary market, either by a cultural norm or due to the complexity;</li>
<li>whether the secondary market solves the problem of double-spending routing tokens.</li>
</ul>
<h2 id="discussion"><a class="header" href="#discussion"><strong>Discussion</strong></a></h2>
<p><strong>Privacy</strong></p>
<p>We believe that the protocol does not leak privacy by analyzing its every aspect:</p>
<ul>
<li>A zero-knowledge proof of UTXO ownership makes the verifier completely oblivious of which of the allowed UTXOs is used. Assuming an adequate anonymity set (allowed UTXOs), this prevents the verifier from associating a UTXO with the prover;</li>
<li>Tokens issued for the same proof are not linkable, and thus, does not allow correlating payments with different tokens of the same proof;</li>
<li>Reissuing a token on payment success or burning it on payment failure prevents payment correlation caused by token reuse;</li>
<li>Ideally, payment senders should obtain tokens in advance, so that routing nodes can’t correlate the payments with proving;</li>
<li>A newly gossiped data (reputation policy) could theoretically leak something about the activity of a routing node, however, this is already the case with existing channel announcement gossip.</li>
</ul>
<p><strong>Resource usage</strong></p>
<p>We believe that the protocol does not increase LN resource requirements significantly:</p>
<ul>
<li>extra bandwidth associated with gossiping reputation policy and communicating tokens is minor;</li>
<li>onions won’t increase in size much after including tokens;</li>
<li>the load of tracking senders’ reputation is on par with current LN operation;</li>
</ul>
<p>The burden associated with ZK proving and verification depends on the cryptosystem.</p>
<p><strong>Compatibility</strong></p>
<p>It remains an open question how this protocol would be combined with trampoline payments. The protocol is likely to be compatible with offline receiving schemes because payees are not involved in the protocol.</p>
<h1 id="conclusion"><a class="header" href="#conclusion"><strong>Conclusion</strong></a></h1>
<p>In this Chapter, we proposed a concrete reputation system for rate-limiting payments, to solve channel jamming. It is based on the combination of two existing ideas: Stake Certificates and Forwarding Pass.</p>
<p>The ultimate challenge is picking the reputation policy, which should be able to distinguish attackers from honest users.</p>
<p>This challenge applies both to the bootstrapping phase (generating a new ID) and grinding phase (earning the actual reputation).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="5-advanced_upfront.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="grand-conclusion.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="5-advanced_upfront.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="grand-conclusion.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
